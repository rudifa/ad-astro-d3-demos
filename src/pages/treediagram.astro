---
import ShoelaceLayout from '../layouts/ShoelaceLayout.astro';
import { TreeDiagram } from '../components/TreeDiagram.js';

const sampleData = {
  name: 'Granddad',
  children: [
    {
      name: 'Child 1',
      children: [{ name: 'Grandchild 1' }, { name: 'Grandchild 2' }],
    },
    {
      name: 'Child 2',
      children: [{ name: 'Grandchild 3' }],
    },
  ],
};
---

<ShoelaceLayout title='Tree Diagram'>
  <div class='container'>
    <h1 class='title'>Tree Diagram</h1>
    <button id='toggleCase'>Toggle Case</button>
    <TreeDiagram client:load data-json={JSON.stringify(sampleData)} />
  </div>
</ShoelaceLayout>

<script>
  let isUppercase = false;
  const toggleButton = document.getElementById('toggleCase');
  const treeDiagram = document.querySelector('tree-diagram') as HTMLElement & {
    data: any;
  };

  const originalData = JSON.parse(
    treeDiagram?.getAttribute('data-json') || '{}'
  );

  function updateTreeDiagram() {
    if (!treeDiagram) return;
    const transformedData = transformData(originalData, isUppercase);
    treeDiagram.setAttribute('data-json', JSON.stringify(transformedData));
    treeDiagram.data = transformedData;
  }

  toggleButton?.addEventListener('click', () => {
    isUppercase = !isUppercase;
    updateTreeDiagram();
  });

  // Using type annotations to make it clear this function is used
  function transformData(data: any, isUppercase: boolean): any {
    if (typeof data !== 'object') return data;

    // console.log('treediagram.transformData data:', data);

    const result = Array.isArray(data) ? [] : {};
    for (const key in data) {
      if (key === 'name') {
        result[key] = isUppercase
          ? data[key].toUpperCase()
          : data[key].toLowerCase();
      } else {
        result[key] = transformData(data[key], isUppercase);
      }
    }
    return result;
  }

  // Ensure the initial render happens
  updateTreeDiagram();
</script>

<style>
  body,
  html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
  }
  .container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column; /* Stack elements vertically */
    justify-content: flex-start; /* Align items to the start of the container */
    align-items: center; /* Center items horizontally */
    border: 2px solid black;
  }
  .title {
    padding-left: 20px; /* Add padding to move the <h1> to the right */
  }
  tree-diagram {
    width: 100%;
    height: 100%;
  }
</style>
